<!DOCTYPE html>
<html lang="ko">    
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta http-equiv="imagetoolbar" content="no" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <title>University Friends with Offline(UFO) | 대팅</title>
    <link rel="stylesheet" href="/css/login.css"/>
    <link rel="icon" type="image/png" href="https://ufwo.s3.ap-northeast-2.amazonaws.com/logo.jpeg">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" />
</head>
  <body>
    <div class="content">
      <div class="header">
        <img class="logo" src="https://ufwo.s3.ap-northeast-2.amazonaws.com/logo.jpeg" onclick="window.location.href='/';" />
      </div>
        <div class="form-box">
            <h1><b>SignIn</b></h1>
            <form>
                <div class="login-box">
                    <div class="message-box hidden" ></div>
                    <div class="input-box">
                        <div class="email">
                		    <span> Email </span> <input type="text" name="email"><br/>
                        </div>
                        <div class="passwd">
                            <span> Password </span> <input type="password" name="passwd"><br/>
                        </div>
                    </div>
                    <input class="send-btn" type="submit" value="LogIn">
                </div>
    	   </form>
        </div>
        <div class='signup'><a href='/users/signup'>Sign Up</a></div>

    	<script>
    		document.querySelector('.send-btn').addEventListener('click', function(e) {
                e.preventDefault();                
    			const email = document.getElementsByName('email')[0].value
                const passwd = document.getElementsByName('passwd')[0].value;
    			sendAjax('/users/login', {'email' : email, 'passwd' : passwd});
    		})
    		function sendAjax(url, data){ 
    			let jsondata = JSON.stringify(data);
    			const xhr = new XMLHttpRequest();
    			xhr.open('POST', url);
    			xhr.setRequestHeader('Content-Type', "application/json");
    			xhr.send(jsondata);

                xhr.addEventListener('load', function () {
                        const message = JSON.parse(xhr.responseText);
                        if (message.success) window.location.href = '/'
                        else {
                            const resultDiv = document.querySelector(".message-box");
                            resultDiv.innerHTML = message.message;
                            resultDiv.removeAttribute('hidden');
                        }
                })}
    	</script>
    </body>
</html>