<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <title>University Friends with Offline(UFO) | 대팅</title>
    <link rel="stylesheet" href="/css/login.css" />
    <link rel="icon" type="image/png" href="https://ufwo.s3.ap-northeast-2.amazonaws.com/logo.jpeg" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" />
  </head>
  <body>
    <div class="content">
      <div class="header">
        <img class="logo" src="https://ufwo.s3.ap-northeast-2.amazonaws.com/logo.jpeg" onclick="window.location.href='/';" />
      </div>
      <div class="form-box">
        <h1><b>Sign Up</b></h1>
        <div class="message-box hidden"></div>
        <div class="email-box">
          <div class="login-box">
            <form method="post" onsubmit="">
              <label class="user-form"> Email <input class="input-box" type="email" name="email" required autofocus /></label>
              <label class="user-form"> Name <input class="input-box" type="text" name="name" required /></label>
              <label class="user-form"> Password <input class="input-box" type="password" name="passwd" required /> </label>
              <label class="user-form"> Password Confirm <input class="input-box" type="password" name="passwdConfirm" required /> </label>
              <label class="user-form"> University <input class="input-box" type="text" name="university" required /></label>
              <label class="user-form">
                Phone Number
                <input class="input-box" type="text" onKeyup="hypenNumber(this);" name="phonenumber" maxlength="13" required
              /></label>
              <div style="width: 100%; text-align: center; margin-bottom: 10px">
                <input type="submit" class="send-btn" value="Submit" />
              </div>
              <label style="width: 100%; text-align: center; color: darkgray"><a href="/users/login">Sign In</a></label>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.querySelector('.send-btn').addEventListener('click', function (e) {
        const email = document.getElementsByName('email')[0].value;
        const name = document.getElementsByName('name')[0].value;
        const passwd = document.getElementsByName('passwd')[0].value;
        const passwdConfirm = document.getElementsByName('passwdConfirm')[0].value;
        const university = document.getElementsByName('university')[0].value;
        const phonenumber = document.getElementsByName('phonenumber')[0].value;
        const url = '/users/join';
        sendSubmitAjax(url, {
          email: email,
          name: name,
          passwd: passwd,
          passwdConfirm: passwdConfirm,
          university: university,
          phonenumber: phonenumber,
        });
        e.preventDefault();
      });
      function sendSubmitAjax(url, data) {
        let jsondata = JSON.stringify(data);
        const xhr = new XMLHttpRequest();
        xhr.open('POST', url);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(jsondata);

        xhr.addEventListener('load', function () {
          const message = JSON.parse(xhr.responseText);
          if (message.success) window.location.href = '/';
          else {
            console.log(xhr.responseText);
            const resultDiv = document.querySelector('.message-box');
            resultDiv.innerHTML = message.message;
            resultDiv.removeAttribute('hidden');
          }
        });
      }

      function hypenNumber(obj) {
        let number = obj.value.replace(/[^0-9]/g, '');
        let phone = '';
        if (number.length < 4) {
          return number;
        } else if (number.length < 7) {
          phone += number.substr(0, 3);
          phone += '-';
          phone += number.substr(3);
        } else if (number.length < 11) {
          phone += number.substr(0, 3);
          phone += '-';
          phone += number.substr(3, 3);
          phone += '-';
          phone += number.substr(6);
        } else {
          phone += number.substr(0, 3);
          phone += '-';
          phone += number.substr(3, 4);
          phone += '-';
          phone += number.substr(7);
        }
        obj.value = phone;
      }
    </script>
  </body>
</html>
